<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server Tools Collection</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ========== EXACT COLORS FROM INDEX(9).HTML ========== */
        :root {
            --primary: #3a56d4;
            --primary-light: #5a72e0;
            --primary-dark: #2a46c4;
            --secondary: #6c757d;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
            --light: #f8f9fa;
            --dark: #212529;
            --border-radius: 8px;
            --transition: all 0.2s ease;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background: #f5f7fa;
            min-height: 100vh;
            padding: 0;
            color: var(--dark);
        }

        /* Dashboard Header */
        .dashboard-header {
            background: linear-gradient(135deg, #2a46c4, #3a56d4);
            color: white;
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        @media (min-width: 768px) {
            .header-content {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
        }

        .header-left h1 {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .header-left .subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .tool-selector {
            display: flex;
            gap: 5px;
            background: rgba(255, 255, 255, 0.1);
            padding: 5px;
            border-radius: var(--border-radius);
            overflow-x: auto;
        }

        .tool-tab {
            padding: 8px 16px;
            border: none;
            background: transparent;
            color: rgba(255, 255, 255, 0.8);
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
            flex: 1;
            justify-content: center;
            min-width: 140px;
        }

        .tool-tab:hover {
            background: rgba(255, 255, 255, 0.15);
            color: white;
        }

        .tool-tab.active {
            background: white;
            color: #3a56d4;
        }

        /* Main Container */
        .dashboard-container {
            max-width: 1400px;
            margin: 20px auto;
            padding: 0 20px;
        }

        .tool-section {
            display: none;
        }

        .tool-section.active {
            display: block;
        }

        /* Card Styles */
        .card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #eaeaea;
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eaeaea;
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #1e293b;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title i {
            color: #3a56d4;
        }

        .badge {
            background: #3a56d4;
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        /* Form Elements */
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #cbd5e1;
            border-radius: var(--border-radius);
            font-family: 'Consolas', monospace;
            font-size: 14px;
            resize: vertical;
            margin-bottom: 15px;
            background: #f8fafc;
        }

        textarea:focus {
            outline: none;
            border-color: #3a56d4;
            box-shadow: 0 0 0 2px rgba(58, 86, 212, 0.1);
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-outline {
            background: white;
            border: 1px solid #cbd5e1;
            color: #64748b;
        }

        .btn-outline:hover {
            background: #f1f5f9;
            color: #1e293b;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.8rem;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
            justify-content: space-between;
        }

        /* Filter Section - Updated for Domain Selector */
        .filter-section {
            background: white;
            border-radius: 10px;
            padding: 15px 20px;
            margin-bottom: 20px;
            border: 1px solid #e2e8f0;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .filter-row {
            display: flex;
            align-items: center;
            gap: 25px;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-label {
            color: #64748b;
            font-size: 13px;
            font-weight: 500;
            min-width: 50px;
        }

        .filter-btn {
            padding: 4px 12px;
            border: 1px solid #cbd5e1;
            border-radius: 30px;
            background: white;
            color: #1e293b;
            font-size: 12px;
            cursor: pointer;
        }

        .filter-btn:hover {
            background: #f1f5f9;
        }

        .filter-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        /* IP Filter Group */
        .ip-filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
            padding-left: 15px;
            border-left: 2px solid #e2e8f0;
        }

        .ip-filter-btn {
            padding: 4px 10px;
            border: 1px solid #f59e0b;
            border-radius: 30px;
            background: #fffbeb;
            color: #b45309;
            font-size: 12px;
            cursor: pointer;
        }

        .ip-filter-btn.active {
            background: #f59e0b;
            color: white;
            border-color: #f59e0b;
        }

        /* NEW: Domain Filter Group */
        .domain-filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
            padding-left: 15px;
            border-left: 2px solid #e2e8f0;
        }

        .domain-filter-btn {
            padding: 4px 10px;
            border: 1px solid #10b981;
            border-radius: 30px;
            background: #e6f7f0;
            color: #047857;
            font-size: 12px;
            cursor: pointer;
        }

        .domain-filter-btn.active {
            background: #10b981;
            color: white;
            border-color: #10b981;
        }

        .domain-badge {
            background: #10b981;
            color: white;
            padding: 4px 12px;
            border-radius: 30px;
            font-size: 12px;
            font-weight: 600;
        }

        .no-domain {
            color: #64748b;
            font-style: italic;
        }

        /* Server Selector Section */
        .server-selector-section {
            background: white;
            border-radius: 12px;
            border: 2px solid #3a56d4;
            margin: 20px 0;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(58, 86, 212, 0.15);
        }

        .server-selector-header {
            background: linear-gradient(135deg, #3a56d4, #2a46c4);
            color: white;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .server-selector-header h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1rem;
        }

        .server-selector-header .toggle-icon {
            font-size: 1.2rem;
            transition: transform 0.3s;
        }

        .server-selector-header.collapsed .toggle-icon {
            transform: rotate(-90deg);
        }

        .server-selector-content {
            padding: 20px;
            background: #f8fafc;
            transition: all 0.3s;
        }

        .server-selector-content.collapsed {
            display: none;
        }

        .server-stats-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
            background: white;
            padding: 12px 16px;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
        }

        .server-stat-badge {
            background: #3a56d4;
            color: white;
            padding: 6px 14px;
            border-radius: 30px;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .server-stat-badge.good {
            background: #10b981;
        }

        .server-stat-badge.bad {
            background: #ef4444;
        }

        .server-stat-badge.warning {
            background: #f59e0b;
        }

        .server-search-box {
            flex: 1;
            min-width: 250px;
            display: flex;
            gap: 8px;
            background: white;
            border: 1px solid #cbd5e1;
            border-radius: 30px;
            padding: 4px 4px 4px 16px;
        }

        .server-search-box input {
            flex: 1;
            border: none;
            outline: none;
            padding: 6px 0;
            font-size: 0.9rem;
            background: transparent;
        }

        .server-search-box button {
            background: #3a56d4;
            color: white;
            border: none;
            border-radius: 30px;
            padding: 6px 16px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
        }

        .server-filter-tabs {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 20px;
            background: white;
            padding: 12px 16px;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
        }

        .server-filter-tab {
            padding: 6px 16px;
            border: 1px solid #cbd5e1;
            border-radius: 30px;
            background: white;
            color: #1e293b;
            font-size: 0.85rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
        }

        .server-filter-tab:hover {
            background: #f1f5f9;
        }

        .server-filter-tab.active {
            background: #3a56d4;
            color: white;
            border-color: #3a56d4;
        }

        .server-filter-tab .count {
            background: #e2e8f0;
            padding: 2px 8px;
            border-radius: 20px;
            font-size: 0.7rem;
            color: #1e293b;
        }

        .server-filter-tab.active .count {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .servers-grid-selector {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 8px;
            max-height: 300px;
            overflow-y: auto;
            padding: 12px;
            background: white;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
            margin-bottom: 20px;
        }

        .server-selector-item {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 30px;
            padding: 8px 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .server-selector-item:hover {
            background: #e6edf8;
            border-color: #3a56d4;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .server-selector-item.selected {
            background: #3a56d4;
            border-color: #3a56d4;
            color: white;
        }

        .server-selector-item .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .server-selector-item .status-dot.good {
            background: #10b981;
            box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.2);
        }

        .server-selector-item .status-dot.bad {
            background: #ef4444;
            box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.2);
        }

        .server-selector-item .status-dot.warning {
            background: #f59e0b;
            box-shadow: 0 0 0 2px rgba(245, 158, 11, 0.2);
        }

        .server-selector-item.selected .status-dot {
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.3);
        }

        .server-selector-item .server-name {
            flex: 1;
            font-family: monospace;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .selected-server-info {
            background: white;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
            overflow: hidden;
        }

        .selected-server-header {
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            padding: 15px 20px;
            border-bottom: 2px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .selected-server-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: #1e293b;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .selected-server-status-badge {
            padding: 6px 16px;
            border-radius: 30px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .selected-server-status-badge.good {
            background: #d1fae5;
            color: #065f46;
        }

        .selected-server-status-badge.bad {
            background: #fee2e2;
            color: #991b1b;
        }

        .selected-server-status-badge.warning {
            background: #fef3c7;
            color: #92400e;
        }

        .server-timeline {
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
        }

        .server-timeline-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px;
            background: #f8fafc;
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 4px solid;
        }

        .timeline-time {
            min-width: 140px;
            color: #64748b;
            font-size: 0.85rem;
        }

        .timeline-stats {
            flex: 1;
            display: flex;
            gap: 20px;
        }

        .timeline-target, .timeline-sent {
            display: flex;
            flex-direction: column;
        }

        .timeline-label {
            font-size: 0.65rem;
            color: #64748b;
            text-transform: uppercase;
        }

        .timeline-value {
            font-weight: 600;
            font-size: 0.95rem;
        }

        .timeline-percentage {
            min-width: 70px;
            text-align: right;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .blocks-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .data-block {
            background: white;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            overflow: hidden;
        }

        .block-header {
            background: #f8fafc;
            padding: 12px 20px;
            border-bottom: 2px solid #e2e8f0;
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .time-badge {
            background: #3b82f6;
            color: white;
            padding: 4px 12px;
            border-radius: 30px;
            font-size: 12px;
        }

        .ip-badge {
            background: #f59e0b;
            color: white;
            padding: 4px 12px;
            border-radius: 30px;
            font-size: 12px;
            font-weight: 600;
        }

        .domain-badge {
            background: #10b981;
            color: white;
            padding: 4px 12px;
            border-radius: 30px;
            font-size: 12px;
            font-weight: 600;
        }

        .servers-grid {
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
        }

        .server-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid;
            transition: all 0.2s;
            cursor: pointer;
        }

        .server-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }

        .server-card.excellent {
            border-left-color: #10b981;
        }

        .server-card.good {
            border-left-color: #3b82f6;
        }

        .server-card.warning {
            border-left-color: #f59e0b;
        }

        .server-card.bad {
            border-left-color: #ef4444;
        }

        .server-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .server-name {
            font-weight: 600;
            color: #1e293b;
            font-size: 14px;
        }

        .server-status {
            font-size: 10px;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 20px;
        }

        .server-status.excellent {
            background: #d1fae5;
            color: #065f46;
        }

        .server-status.good {
            background: #dbeafe;
            color: #1e40af;
        }

        .server-status.warning {
            background: #fef3c7;
            color: #92400e;
        }

        .server-status.bad {
            background: #fee2e2;
            color: #991b1b;
        }

        .stats-row {
            display: flex;
            justify-content: space-between;
            background: white;
            padding: 8px 10px;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
            margin: 10px 0;
        }

        .target-box .label, .sent-box .label {
            color: #64748b;
            font-size: 9px;
            text-transform: uppercase;
        }

        .target-box .value {
            font-weight: 700;
            font-size: 14px;
            color: #1e293b;
        }

        .sent-box .value {
            font-weight: 700;
            font-size: 14px;
        }

        .sent-box .value.excellent {
            color: #10b981;
        }

        .sent-box .value.good {
            color: #3b82f6;
        }

        .sent-box .value.warning {
            color: #f59e0b;
        }

        .sent-box .value.bad {
            color: #ef4444;
        }

        .progress-bar {
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
        }

        .progress-fill.excellent {
            background: #10b981;
        }

        .progress-fill.good {
            background: #3b82f6;
        }

        .progress-fill.warning {
            background: #f59e0b;
        }

        .progress-fill.bad {
            background: #ef4444;
        }

        .percentage {
            font-size: 11px;
            color: #64748b;
            text-align: right;
        }

        .hidden {
            display: none;
        }

        .no-data {
            text-align: center;
            padding: 40px;
            background: white;
            border-radius: 12px;
            color: #64748b;
            border: 1px solid #e2e8f0;
        }

        .toast-message {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: #3a56d4;
            color: white;
            padding: 12px 24px;
            border-radius: 40px;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            animation: slideIn 0.3s ease, fadeOut 0.3s ease 1.7s;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        .copied {
            background: #28a745 !important;
        }
        
        .btn.success {
            background: #28a745 !important;
            color: white !important;
            border-color: #28a745 !important;
        }
    </style>
</head>
<body>
    <!-- Dashboard Header -->
    <div class="dashboard-header">
        <div class="header-content">
            <div class="header-left">
                <h1>Server Tools Dashboard</h1>
                <p class="subtitle">Server Performance ¬∑ Domain/IP Explorer ¬∑ Email Error Parser</p>
            </div>
            <div class="tool-selector">
                <button class="tool-tab active" onclick="switchTab(0)">üìä Server Performance</button>
                <button class="tool-tab" onclick="switchTab(1)">üåê Domain/IP Explorer</button>
                <button class="tool-tab" onclick="switchTab(2)">üìß Email Error Parser</button>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="dashboard-container">
        <!-- Tab 0: Server Performance Analyzer -->
        <div id="tab0" class="tool-section active">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-chart-line"></i> Server Performance Analyzer</h2>
                </div>
                
                <textarea id="inputData" placeholder="Paste your server performance data here..."></textarea>
                
                <div class="button-group">
                    <button class="btn btn-primary" onclick="parseData()"><i class="fas fa-play"></i> Parse Data</button>
                    <button class="btn btn-outline" onclick="resetFilters()"><i class="fas fa-undo"></i> Reset Filters</button>
                    <button class="btn btn-danger" onclick="resetServerPerformance()"><i class="fas fa-trash"></i> Clear All</button>
                </div>
            </div>

            <!-- Server Selector Section -->
            <div id="serverSelectorSection" class="server-selector-section" style="display: none;">
                <div class="server-selector-header" onclick="toggleServerSelector()">
                    <h3>
                        <i class="fas fa-server"></i>
                        Server Selector
                        <span id="totalServersBadge" class="badge" style="background: rgba(255,255,255,0.2);">0 servers</span>
                    </h3>
                    <i class="fas fa-chevron-down toggle-icon" id="selectorToggleIcon"></i>
                </div>
                <div class="server-selector-content collapsed" id="serverSelectorContent">
                    <div class="server-stats-bar">
                        <div class="server-stat-badge good">
                            <i class="fas fa-check-circle"></i>
                            <span id="goodServersCount">0 Good</span>
                        </div>
                        <div class="server-stat-badge warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span id="warningServersCount">0 Warning</span>
                        </div>
                        <div class="server-stat-badge bad">
                            <i class="fas fa-exclamation-circle"></i>
                            <span id="badServersCount">0 Bad</span>
                        </div>
                        <div class="server-search-box">
                            <input type="text" id="serverSearchInput" placeholder="Search server name..." onkeyup="filterServers()">
                            <button onclick="filterServers()"><i class="fas fa-search"></i> Search</button>
                        </div>
                    </div>

                    <div class="server-filter-tabs">
                        <button class="server-filter-tab active" onclick="filterServersByStatus('all')">
                            <i class="fas fa-list"></i> All <span class="count" id="allServersCount">0</span>
                        </button>
                        <button class="server-filter-tab" onclick="filterServersByStatus('good')">
                            <i class="fas fa-check-circle"></i> Good <span class="count" id="goodFilterCount">0</span>
                        </button>
                        <button class="server-filter-tab" onclick="filterServersByStatus('warning')">
                            <i class="fas fa-exclamation-triangle"></i> Warning <span class="count" id="warningFilterCount">0</span>
                        </button>
                        <button class="server-filter-tab" onclick="filterServersByStatus('bad')">
                            <i class="fas fa-exclamation-circle"></i> Bad <span class="count" id="badFilterCount">0</span>
                        </button>
                    </div>

                    <div id="serversGrid" class="servers-grid-selector"></div>

                    <div id="selectedServerInfo" class="selected-server-info" style="display: none;">
                        <div class="selected-server-header">
                            <div class="selected-server-name">
                                <i class="fas fa-server"></i>
                                <span id="selectedServerName">server_name</span>
                            </div>
                            <span id="selectedServerStatus" class="selected-server-status-badge">status</span>
                        </div>
                        <div id="serverTimeline" class="server-timeline"></div>
                    </div>
                </div>
            </div>

            <div id="results" class="hidden">
                <div class="filter-section" id="filterSection"></div>
                <div id="blocksContainer" class="blocks-container"></div>
            </div>
        </div>

        <!-- Tab 1: Domain/IP Explorer (updated) -->
        <div id="tab1" class="tool-section">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-globe"></i> Domain/IP Explorer</h2>
                    <span class="badge" id="blockCount">0 blocks</span>
                </div>
                
                <textarea id="rawInput" placeholder="Paste your message send bot logs‚Ä¶"></textarea>
            </div>

            <!-- Domain Filter Bar (NEW) -->
            <div class="ip-index-bar" style="background: #e8f5e9; border-color: #10b981;">
                <span class="card-title" style="margin:0; color: #047857;">
                    <i class="fas fa-globe"></i> by Domain
                </span>
                <div class="ip-pills" id="domainPillsContainer"></div>
                <div class="reset-pill" id="resetDomainSelection">show all domains</div>
            </div>

            <!-- IP Filter Bar (existing) -->
            <div class="ip-index-bar">
                <span class="card-title" style="margin:0;"><i class="fas fa-filter"></i> by IP value</span>
                <div class="ip-pills" id="ipPillsContainer"></div>
                <div class="reset-pill" id="resetSelection">show all IPs</div>
            </div>

            <div class="stats-line">
                <span id="selectedFilterLabel">üåê all groups</span> ¬∑ <span id="serverCountDisplay">0 servers</span>
                <div>
                    <button class="btn btn-outline btn-sm" id="resetIPExplorerBtn" title="Reset everything to default">
                        <i class="fas fa-trash"></i> full reset
                    </button>
                    <button class="btn btn-outline btn-sm" id="downloadTableBtn" title="Download filtered data as CSV">
                        <i class="fas fa-download"></i> download CSV
                    </button>
                </div>
            </div>

            <div id="resultsContainer" class="masonry-grid">
                <div class="placeholder-nodata">üëÜ paste data, then click any domain or IP pill</div>
            </div>
        </div>

        <!-- Tab 2: Email Error Parser -->
        <div id="tab2" class="tool-section">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-envelope"></i> Email Error Parser</h2>
                    <p>Click on any error type to see its IPs</p>
                </div>
                
                <textarea id="inputText" placeholder="Paste your error log here..."></textarea>
                
                <div class="button-group">
                    <div class="left-buttons">
                        <button class="btn btn-primary" onclick="parseErrors()">
                            <i class="fas fa-play"></i> Parse Errors
                        </button>
                    </div>
                    <div class="right-buttons">
                        <button class="btn btn-danger" onclick="resetEmailParser()">
                            <i class="fas fa-trash"></i> Reset Everything
                        </button>
                    </div>
                </div>
            </div>

            <!-- Summary Cards -->
            <div id="summaryCards" class="summary-cards" style="display: none;"></div>

            <!-- Detected Errors Section -->
            <div id="errorSelector" class="error-type-selector" style="display: none;">
                <div class="detected-errors-title">
                    <h3><i class="fas fa-tags"></i> Detected Errors</h3>
                    <span id="errorCount" class="error-count-badge">0 errors</span>
                </div>
                
                <div id="errorTabs" class="error-type-tabs"></div>

                <div id="errorContent" class="error-content" style="display: none;"></div>
            </div>

            <!-- Loading -->
            <div id="loading" class="loading" style="display: none;">
                <div class="spinner"></div>
                <p>Parsing error data...</p>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer"></div>

    <script>
        // ==================== TAB SWITCHING ====================
        function switchTab(index) {
            document.querySelectorAll('.tool-tab').forEach((btn, i) => {
                if (i === index) btn.classList.add('active');
                else btn.classList.remove('active');
            });
            
            document.querySelectorAll('.tool-section').forEach((section, i) => {
                if (i === index) section.classList.add('active');
                else section.classList.remove('active');
            });
        }

        // ==================== TOAST NOTIFICATION ====================
        function showToast(message, duration = 2000, isError = false) {
            const toastContainer = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = 'toast-message';
            toast.style.background = isError ? '#dc3545' : '#3a56d4';
            toast.textContent = message;
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, duration);
        }

        // ==================== SERVER SELECTOR STATE ====================
        let serverSelectorCollapsed = true;
        let currentServerFilter = 'all';
        let serverSearchTerm = '';
        let selectedServer = null;
        let allServersList = [];

        function toggleServerSelector() {
            serverSelectorCollapsed = !serverSelectorCollapsed;
            const content = document.getElementById('serverSelectorContent');
            const icon = document.getElementById('selectorToggleIcon');
            const header = document.querySelector('.server-selector-header');
            
            if (serverSelectorCollapsed) {
                content.classList.add('collapsed');
                icon.style.transform = 'rotate(-90deg)';
                header.classList.add('collapsed');
            } else {
                content.classList.remove('collapsed');
                icon.style.transform = 'rotate(0deg)';
                header.classList.remove('collapsed');
            }
        }

        function filterServers() {
            serverSearchTerm = document.getElementById('serverSearchInput').value.toLowerCase();
            renderServersGrid();
        }

        function filterServersByStatus(status) {
            currentServerFilter = status;
            
            document.querySelectorAll('.server-filter-tab').forEach(tab => {
                if (tab.textContent.toLowerCase().includes(status) || 
                    (status === 'all' && tab.textContent.includes('All'))) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
            
            renderServersGrid();
        }

        function selectServer(serverName) {
            selectedServer = serverName;
            
            document.querySelectorAll('.server-selector-item').forEach(item => {
                if (item.dataset.server === serverName) {
                    item.classList.add('selected');
                } else {
                    item.classList.remove('selected');
                }
            });
            
            showServerTimeline(serverName);
        }

        function getServerOverallStatus(serverName) {
            let totalPercentage = 0;
            let count = 0;
            let hasDown = false;
            
            blocks.forEach(block => {
                const server = block.servers.find(s => s.name === serverName);
                if (server) {
                    if (server.isDown) {
                        hasDown = true;
                        totalPercentage += 0;
                    } else {
                        totalPercentage += server.percentage;
                    }
                    count++;
                }
            });
            
            if (count === 0) return 'good';
            
            // If more than half the occurrences are down, mark as bad
            const downCount = blocks.filter(block => {
                const server = block.servers.find(s => s.name === serverName);
                return server && server.isDown;
            }).length;
            
            if (downCount > count / 2) return 'bad';
            
            const avgPercentage = totalPercentage / count;
            
            if (avgPercentage >= 100) return 'good';
            if (avgPercentage >= 70) return 'good';
            if (avgPercentage >= 60) return 'warning';
            return 'bad';
        }

        function showServerTimeline(serverName) {
            const timelineDiv = document.getElementById('serverTimeline');
            const infoDiv = document.getElementById('selectedServerInfo');
            
            const serverOccurrences = [];
            blocks.forEach(block => {
                const server = block.servers.find(s => s.name === serverName);
                if (server) {
                    serverOccurrences.push({
                        datetime: block.datetime,
                        byIP: block.byIP,
                        domain: block.domain || 'N/A',
                        ...server
                    });
                }
            });
            
            if (serverOccurrences.length === 0) {
                infoDiv.style.display = 'none';
                return;
            }
            
            const overallStatus = getServerOverallStatus(serverName);
            
            document.getElementById('selectedServerName').textContent = serverName;
            const statusSpan = document.getElementById('selectedServerStatus');
            statusSpan.textContent = overallStatus.toUpperCase();
            statusSpan.className = `selected-server-status-badge ${overallStatus}`;
            
            let timelineHtml = '';
            serverOccurrences.sort((a, b) => a.datetime.localeCompare(b.datetime)).forEach(occ => {
                if (occ.isDown) {
                    timelineHtml += `
                        <div class="server-timeline-item" style="border-left-color: #ef4444;">
                            <div class="timeline-time"><i class="far fa-clock"></i> ${occ.datetime}</div>
                            <div style="flex:1; color: #ef4444; font-weight: 600;"><i class="fas fa-exclamation-triangle"></i> SERVER DOWN</div>
                            <div class="timeline-percentage" style="color: #ef4444;">Domain: ${occ.domain}</div>
                        </div>
                    `;
                } else {
                    const statusColor = occ.status === 'excellent' ? '#10b981' : 
                                      occ.status === 'good' ? '#3b82f6' :
                                      occ.status === 'warning' ? '#f59e0b' : '#ef4444';
                    
                    timelineHtml += `
                        <div class="server-timeline-item" style="border-left-color: ${statusColor};">
                            <div class="timeline-time"><i class="far fa-clock"></i> ${occ.datetime}</div>
                            <div class="timeline-stats">
                                <div class="timeline-target">
                                    <span class="timeline-label">TARGET</span>
                                    <span class="timeline-value">${occ.target.toLocaleString()}</span>
                                </div>
                                <div class="timeline-sent">
                                    <span class="timeline-label">SENT</span>
                                    <span class="timeline-value" style="color: ${statusColor};">${occ.sent.toLocaleString()}</span>
                                </div>
                            </div>
                            <div class="timeline-percentage" style="color: ${statusColor};">
                                ${occ.percentage.toFixed(1)}%
                            </div>
                        </div>
                    `;
                }
            });
            
            timelineDiv.innerHTML = timelineHtml;
            infoDiv.style.display = 'block';
        }

        function renderServersGrid() {
            if (!blocks || blocks.length === 0) return;
            
            const serverMap = new Map();
            
            blocks.forEach(block => {
                block.servers.forEach(server => {
                    if (!serverMap.has(server.name)) {
                        serverMap.set(server.name, {
                            name: server.name,
                            occurrences: 1
                        });
                    } else {
                        const existing = serverMap.get(server.name);
                        existing.occurrences++;
                    }
                });
            });
            
            allServersList = Array.from(serverMap.values()).map(s => ({
                ...s,
                status: getServerOverallStatus(s.name)
            }));
            
            const goodCount = allServersList.filter(s => s.status === 'good').length;
            const warningCount = allServersList.filter(s => s.status === 'warning').length;
            const badCount = allServersList.filter(s => s.status === 'bad').length;
            
            document.getElementById('totalServersBadge').textContent = `${allServersList.length} servers`;
            document.getElementById('allServersCount').textContent = allServersList.length;
            document.getElementById('goodFilterCount').textContent = goodCount;
            document.getElementById('warningFilterCount').textContent = warningCount;
            document.getElementById('badFilterCount').textContent = badCount;
            document.getElementById('goodServersCount').textContent = `${goodCount} Good`;
            document.getElementById('warningServersCount').textContent = `${warningCount} Warning`;
            document.getElementById('badServersCount').textContent = `${badCount} Bad`;
            
            let filteredServers = [...allServersList];
            
            if (currentServerFilter !== 'all') {
                filteredServers = filteredServers.filter(s => s.status === currentServerFilter);
            }
            
            if (serverSearchTerm) {
                filteredServers = filteredServers.filter(s => 
                    s.name.toLowerCase().includes(serverSearchTerm)
                );
            }
            
            const grid = document.getElementById('serversGrid');
            
            if (filteredServers.length === 0) {
                grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 30px; color: #64748b;">No servers match the filters</div>';
                return;
            }
            
            let gridHtml = '';
            filteredServers.sort((a, b) => a.name.localeCompare(b.name)).forEach(server => {
                const statusDotClass = server.status;
                const selectedClass = selectedServer === server.name ? 'selected' : '';
                
                gridHtml += `
                    <div class="server-selector-item ${selectedClass}" data-server="${server.name}" onclick="selectServer('${server.name}')">
                        <span class="status-dot ${statusDotClass}"></span>
                        <span class="server-name">${server.name}</span>
                        <span style="font-size: 0.7rem; opacity: 0.7; background: #e2e8f0; padding: 2px 6px; border-radius: 12px;">${server.occurrences}</span>
                    </div>
                `;
            });
            
            grid.innerHTML = gridHtml;
            
            if (selectedServer) {
                const exists = allServersList.some(s => s.name === selectedServer);
                if (!exists) {
                    selectedServer = null;
                    document.getElementById('selectedServerInfo').style.display = 'none';
                } else {
                    document.querySelectorAll('.server-selector-item').forEach(item => {
                        if (item.dataset.server === selectedServer) {
                            item.classList.add('selected');
                        }
                    });
                    showServerTimeline(selectedServer);
                }
            }
        }

        // ==================== TOOL 1: SERVER PERFORMANCE ANALYZER ====================
        let blocks = [];
        let originalInput = '';
        let currentStatusFilter = 'all';
        let currentIPFilter = 'all';
        let currentDomainFilter = 'all';

        window.parseData = function() {
            const text = document.getElementById('inputData').value;
            if (!text.trim()) {
                showToast('Please paste some data first', 2000, true);
                return;
            }
            
            originalInput = text;
            
            // The format is: [block content] ------ \n RP: domain \n DOO: domain \n\n [next block]
            // So RP/DOO appear AFTER the ------ separator, belonging to the block BEFORE it.
            // Strategy: split by the pattern "------\n    RP:" to keep domain with its block.
            
            // First, pair each block with its domain by splitting on newlines and tracking sections
            const rawChunks = text.split('------');
            // rawChunks[0] = first block content
            // rawChunks[1] = "RP:...\nDOO:...\n\n[second block content]"
            // etc.
            
            // Each chunk after index 0 starts with RP/DOO lines for the PREVIOUS block
            const parsedBlocks = [];
            
            for (let i = 0; i < rawChunks.length; i++) {
                const chunk = rawChunks[i];
                if (!chunk.trim()) continue;
                
                const lines = chunk.split('\n').map(l => l.trim()).filter(l => l);
                
                if (i === 0) {
                    // First chunk: pure block content, no domain yet (domain comes after first ------ )
                    const blockData = parseBlockLines(lines);
                    if (blockData) parsedBlocks.push(blockData);
                } else {
                    // This chunk starts with RP:/DOO: lines for the PREVIOUS block,
                    // then contains the next block's content after a blank separator
                    
                    // Extract domain lines at the start
                    let domain = null;
                    let contentStartIndex = 0;
                    
                    for (let j = 0; j < lines.length; j++) {
                        const line = lines[j];
                        if (line.startsWith('RP:')) {
                            const rpMatch = line.match(/RP:\s*(.+)/);
                            if (rpMatch) {
                                const val = rpMatch[1].trim();
                                if (!val.includes('[RDNS]') && !val.includes('N/A') && val.includes('.')) {
                                    domain = val;
                                }
                            }
                            contentStartIndex = j + 1;
                        } else if (line.startsWith('DOO:')) {
                            if (!domain) {
                                const dooMatch = line.match(/DOO:\s*(.+)/);
                                if (dooMatch) {
                                    const val = dooMatch[1].trim();
                                    if (!val.includes('[RDNS]') && !val.includes('N/A') && val.includes('.')) {
                                        domain = val;
                                    }
                                }
                            }
                            contentStartIndex = j + 1;
                        } else if (line.startsWith('RP:') || line.startsWith('DOO:')) {
                            contentStartIndex = j + 1;
                        } else if (domain !== undefined && contentStartIndex > 0) {
                            break;
                        }
                    }
                    
                    // Assign domain to previous block
                    if (parsedBlocks.length > 0) {
                        parsedBlocks[parsedBlocks.length - 1].domain = domain;
                    }
                    
                    // Parse the rest as the next block
                    const remainingLines = lines.slice(contentStartIndex);
                    if (remainingLines.length > 0) {
                        const blockData = parseBlockLines(remainingLines);
                        if (blockData) parsedBlocks.push(blockData);
                    }
                }
            }
            
            function parseBlockLines(lines) {
                const blockData = {
                    datetime: '',
                    byIP: 0,
                    domain: null,
                    servers: [],
                    rawText: lines.join('\n')
                };
                
                lines.forEach(line => {
                    if (line.match(/\d{2}\/\d{2}\s+\d{2}:\d{2}:\d{2}/)) {
                        blockData.datetime = line;
                    }
                    
                    if (line.includes('By IP:')) {
                        const match = line.match(/[\d,.]+/);
                        if (match) {
                            blockData.byIP = parseFloat(match[0].replace(/,/g, ''));
                        }
                    }
                    
                    if (line.startsWith('üü¢')) {
                        const match = line.match(/üü¢\s+([^:]+):\s+(\d+)\s+(\d+)/);
                        if (match) {
                            const target = parseInt(match[2]);
                            const sent = parseInt(match[3]);
                            const percentage = target > 0 ? (sent / target * 100) : 0;
                            
                            let status = '';
                            if (percentage >= 100) status = 'excellent';
                            else if (percentage >= 70) status = 'good';
                            else if (percentage >= 60) status = 'warning';
                            else status = 'bad';
                            
                            blockData.servers.push({
                                name: match[1].trim(),
                                target: target,
                                sent: sent,
                                percentage: percentage,
                                status: status,
                                isDown: false,
                                raw: line
                            });
                        }
                    }
                    
                    if (line.startsWith('üí•')) {
                        const match = line.match(/üí•\s+([^:]+)/);
                        if (match) {
                            const serverName = match[1].trim().split(':')[0];
                            blockData.servers.push({
                                name: serverName,
                                target: 0,
                                sent: 0,
                                percentage: 0,
                                status: 'bad',
                                isDown: true,
                                raw: line
                            });
                        }
                    }
                });
                
                return blockData.servers.length > 0 ? blockData : null;
            }
            
            blocks = parsedBlocks;

            if (blocks.length === 0) {
                showToast('No valid data blocks found', 2000, true);
                return;
            }

            document.getElementById('serverSelectorSection').style.display = 'block';
            
            selectedServer = null;
            currentServerFilter = 'all';
            serverSearchTerm = '';
            document.getElementById('serverSearchInput').value = '';
            
            const content = document.getElementById('serverSelectorContent');
            const icon = document.getElementById('selectorToggleIcon');
            content.classList.add('collapsed');
            icon.style.transform = 'rotate(-90deg)';
            document.querySelector('.server-selector-header').classList.add('collapsed');
            serverSelectorCollapsed = true;
            
            renderServersGrid();

            displayFilters();
            displayBlocks();
            document.getElementById('results').classList.remove('hidden');
            showToast(`Found ${blocks.length} data blocks`);
        };

        function displayFilters() {
            const ipValues = [...new Set(blocks.map(b => b.byIP).filter(ip => ip > 0))].sort((a, b) => a - b);
            const domainValues = [...new Set(blocks.map(b => b.domain).filter(d => d))].sort();
            
            let filterHTML = `
                <div class="filter-row">
                    <div class="filter-group">
                        <span class="filter-label">Status:</span>
                        <button class="filter-btn ${currentStatusFilter === 'all' ? 'active' : ''}" onclick="filterByStatus('all')">ALL</button>
                        <button class="filter-btn ${currentStatusFilter === 'good' ? 'active' : ''}" onclick="filterByStatus('good')">GOOD (‚â•70%)</button>
                        <button class="filter-btn ${currentStatusFilter === 'bad' ? 'active' : ''}" onclick="filterByStatus('bad')">BAD (Down or <60%)</button>
                    </div>
            `;
            
            if (ipValues.length > 0) {
                filterHTML += `
                    <div class="ip-filter-group">
                        <span class="filter-label">By IP:</span>
                        <button class="ip-filter-btn ${currentIPFilter === 'all' ? 'active' : ''}" onclick="filterByIP('all')">ALL</button>
                `;
                
                ipValues.forEach(ip => {
                    filterHTML += `<button class="ip-filter-btn ${currentIPFilter === ip ? 'active' : ''}" onclick="filterByIP(${ip})">${ip.toLocaleString()}</button>`;
                });
                
                filterHTML += `</div>`;
            }
            
            if (domainValues.length > 0) {
                filterHTML += `
                    <div class="domain-filter-group">
                        <span class="filter-label">By Domain:</span>
                        <button class="domain-filter-btn ${currentDomainFilter === 'all' ? 'active' : ''}" onclick="filterByDomain('all')">ALL</button>
                        <button class="domain-filter-btn ${currentDomainFilter === '__has_domain__' ? 'active' : ''}" onclick="filterByDomain('__has_domain__')">üåê With Domain</button>
                        <button class="domain-filter-btn ${currentDomainFilter === '__no_domain__' ? 'active' : ''}" onclick="filterByDomain('__no_domain__')" style="border-color:#94a3b8;background:#f1f5f9;color:#475569;">üì° RDNS Only</button>
                `;
                
                domainValues.forEach(domain => {
                    filterHTML += `<button class="domain-filter-btn ${currentDomainFilter === domain ? 'active' : ''}" onclick="filterByDomain('${domain}')">${domain}</button>`;
                });
                
                filterHTML += `</div>`;
            }
            
            filterHTML += `</div><div class="filter-row"><div class="action-buttons">
                    <button class="btn btn-outline btn-sm" onclick="copySelectedNames()">
                        <i class="fas fa-copy"></i> Copy Names
                    </button>
                </div></div>
            `;
            
            document.getElementById('filterSection').innerHTML = filterHTML;
        }

        function displayBlocks() {
            const container = document.getElementById('blocksContainer');
            
            let filteredBlocks = blocks;
            
            // Apply IP filter
            if (currentIPFilter !== 'all') {
                filteredBlocks = filteredBlocks.filter(b => b.byIP === currentIPFilter);
            }
            
            // Apply Domain filter
            if (currentDomainFilter === '__has_domain__') {
                filteredBlocks = filteredBlocks.filter(b => b.domain && b.domain.trim() !== '');
            } else if (currentDomainFilter === '__no_domain__') {
                filteredBlocks = filteredBlocks.filter(b => !b.domain || b.domain.trim() === '');
            } else if (currentDomainFilter !== 'all') {
                filteredBlocks = filteredBlocks.filter(b => b.domain && b.domain === currentDomainFilter);
            }
            
            if (filteredBlocks.length === 0) {
                container.innerHTML = '<div class="no-data"><i class="fas fa-info-circle"></i> No blocks match the selected filters</div>';
                return;
            }
            
            const blocksHTML = filteredBlocks.map((block, index) => {
                let filteredServers = block.servers;
                if (currentStatusFilter === 'good') {
                    filteredServers = block.servers.filter(s => !s.isDown && s.percentage >= 70);
                } else if (currentStatusFilter === 'bad') {
                    filteredServers = block.servers.filter(s => s.isDown || (!s.isDown && s.percentage < 60));
                }
                
                if (filteredServers.length === 0) return '';
                
                return `
                    <div class="data-block" data-block-datetime="${block.datetime}" data-block-ip="${block.byIP}" data-block-domain="${block.domain || ''}">
                        <div class="block-header">
                            <span class="time-badge"><i class="far fa-clock"></i> ${block.datetime}</span>
                            ${block.byIP ? `<span class="ip-badge"><i class="fas fa-bullseye"></i> ${block.byIP.toLocaleString()} per IP</span>` : ''}
                            ${block.domain ? `<span class="domain-badge"><i class="fas fa-globe"></i> ${block.domain}</span>` : '<span class="no-domain">No domain</span>'}
                            <div class="block-actions">
                                <button class="btn btn-outline btn-sm copy-block-btn" onclick="copyBlockNames('${block.datetime}', ${block.byIP}, event)">
                                    <i class="fas fa-copy"></i> Copy Names
                                </button>
                            </div>
                        </div>
                        <div class="servers-grid">
                            ${filteredServers.map(server => {
                                if (server.isDown) {
                                    return `
                                        <div class="server-card bad" onclick="selectServer('${server.name}')" style="cursor: pointer;">
                                            <div class="server-header">
                                                <span class="server-name"><i class="fas fa-exclamation-triangle"></i> ${server.name}</span>
                                                <span class="server-status bad">DOWN</span>
                                            </div>
                                            <div style="color: #64748b; text-align: center; padding: 10px;">
                                                Server Down
                                            </div>
                                        </div>
                                    `;
                                } else {
                                    return `
                                        <div class="server-card ${server.status}" onclick="selectServer('${server.name}')" style="cursor: pointer;">
                                            <div class="server-header">
                                                <span class="server-name"><i class="fas fa-server"></i> ${server.name}</span>
                                                <span class="server-status ${server.status}">${server.status.toUpperCase()}</span>
                                            </div>
                                            
                                            <div class="stats-row">
                                                <div class="target-box">
                                                    <div class="label">TARGET</div>
                                                    <div class="value">${server.target.toLocaleString()}</div>
                                                </div>
                                                <div class="sent-box">
                                                    <div class="label">SENT</div>
                                                    <div class="value ${server.status}">${server.sent.toLocaleString()}</div>
                                                </div>
                                            </div>
                                            
                                            <div class="progress-bar">
                                                <div class="progress-fill ${server.status}" 
                                                     style="width: ${Math.min(server.percentage, 100)}%"></div>
                                            </div>
                                            <div class="percentage">
                                                ${server.percentage.toFixed(1)}% of target
                                            </div>
                                        </div>
                                    `;
                                }
                            }).join('')}
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = blocksHTML;
        }

        window.filterByStatus = function(status) {
            currentStatusFilter = status;
            displayFilters();
            displayBlocks();
        };

        window.filterByIP = function(ip) {
            currentIPFilter = ip;
            currentDomainFilter = 'all'; // Reset domain filter when IP is selected
            displayFilters();
            displayBlocks();
        };

        window.filterByDomain = function(domain) {
            currentDomainFilter = domain;
            currentIPFilter = 'all'; // Reset IP filter when domain is selected
            displayFilters();
            displayBlocks();
        };

        window.resetFilters = function() {
            currentStatusFilter = 'all';
            currentIPFilter = 'all';
            currentDomainFilter = 'all';
            displayFilters();
            displayBlocks();
            showToast('Filters reset');
        };

        window.resetServerPerformance = function() {
            document.getElementById('inputData').value = '';
            
            blocks = [];
            originalInput = '';
            
            currentStatusFilter = 'all';
            currentIPFilter = 'all';
            currentDomainFilter = 'all';
            
            document.getElementById('results').classList.add('hidden');
            document.getElementById('serverSelectorSection').style.display = 'none';
            
            showToast('Server Performance - cleared');
        };

        function copySelectedNames() {
            if (blocks.length === 0) {
                showToast('No data to copy', 2000, true);
                return;
            }

            let filteredBlocks = blocks;
            if (currentIPFilter !== 'all') {
                filteredBlocks = filteredBlocks.filter(b => b.byIP === currentIPFilter);
            }
            if (currentDomainFilter !== 'all') {
                filteredBlocks = filteredBlocks.filter(b => b.domain === currentDomainFilter);
            }

            let allNames = [];
            
            filteredBlocks.forEach(block => {
                let filteredServers = block.servers;
                if (currentStatusFilter === 'good') {
                    filteredServers = block.servers.filter(s => !s.isDown && s.percentage >= 70);
                } else if (currentStatusFilter === 'bad') {
                    filteredServers = block.servers.filter(s => s.isDown || (!s.isDown && s.percentage < 60));
                }
                
                filteredServers.forEach(server => {
                    allNames.push(server.name);
                });
            });
            
            if (allNames.length === 0) {
                showToast('No servers match the filters', 2000, true);
                return;
            }
            
            const namesText = allNames.join('\n');
            
            navigator.clipboard.writeText(namesText).then(() => {
                showToast(`${allNames.length} server names copied!`);
                
                const btn = event.target;
                const originalText = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                btn.classList.add('success');
                
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.classList.remove('success');
                }, 2000);
            }).catch(() => {
                showToast('Failed to copy', 2000, true);
            });
        }

        window.copyBlockNames = function(datetime, ip, event) {
            const block = blocks.find(b => b.datetime === datetime && b.byIP === ip);
            
            if (!block) {
                showToast('Block not found', 2000, true);
                return;
            }
            
            let filteredServers = block.servers;
            if (currentStatusFilter === 'good') {
                filteredServers = block.servers.filter(s => !s.isDown && s.percentage >= 70);
            } else if (currentStatusFilter === 'bad') {
                filteredServers = block.servers.filter(s => s.isDown || (!s.isDown && s.percentage < 60));
            }
            
            const names = filteredServers.map(s => s.name);
            
            if (names.length === 0) {
                showToast('No servers in this block', 2000, true);
                return;
            }
            
            const namesText = names.join('\n');
            
            navigator.clipboard.writeText(namesText).then(() => {
                const btn = event.target;
                const originalText = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                btn.classList.add('success');
                
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.classList.remove('success');
                }, 2000);
                
                showToast(`${names.length} server names copied!`);
            }).catch(() => {
                showToast('Failed to copy', 2000, true);
            });
        };

        // ==================== TOOL 2: DOMAIN/IP EXPLORER (UPDATED) ====================
        (function() {
            const rawArea = document.getElementById('rawInput');
            const domainPillsContainer = document.getElementById('domainPillsContainer');
            const ipPillsContainer = document.getElementById('ipPillsContainer');
            const resetDomainBtn = document.getElementById('resetDomainSelection');
            const resetIPBtn = document.getElementById('resetSelection');
            const fullResetBtn = document.getElementById('resetIPExplorerBtn');
            const resultsContainer = document.getElementById('resultsContainer');
            const selectedFilterLabel = document.getElementById('selectedFilterLabel');
            const serverCountDisplay = document.getElementById('serverCountDisplay');
            const blockCountSpan = document.getElementById('blockCount');
            const downloadBtn = document.getElementById('downloadTableBtn');

            let allBlocks = [];
            let uniqueIPs = [];
            let uniqueDomains = [];
            let currentFilterType = null; // 'ip' or 'domain'
            let currentFilterValue = null;

            function parseBlocks(text) {
                const blocks = [];
                
                const rawBlocks = text.split(/(?=Message Send bot|TEAM:|(?<=\n|^)\d+\s+BY\s+IP)/g);
                
                for (let block of rawBlocks) {
                    block = block.trim();
                    if (!block || block.length < 5) continue;

                    let timestamp = 'unknown time';
                    
                    const msgTimestampMatch = block.match(/Message Send bot,\s*\[(.*?)\]/);
                    if (msgTimestampMatch) {
                        timestamp = msgTimestampMatch[1];
                    } else {
                        const timeMatch = block.match(/(\d{2}\/\d{2}\/\d{4}\s+\d{2}:\d{2})|(\d{2}\/\d{2}\/\d{4})|(\d{2}:\d{2}:\d{2})|(\d{2}:\d{2})/);
                        if (timeMatch) {
                            timestamp = timeMatch[0];
                        }
                    }

                    let byIP = null;
                    
                    const byIPMatch = block.match(/By IP:\s*([\d,]+(?:\.\d+)?)/);
                    if (byIPMatch) {
                        byIP = parseFloat(byIPMatch[1].replace(/,/g, ''));
                    } else {
                        const byIpTitleMatch = block.match(/^(\d+)\s+BY\s+IP/im);
                        if (byIpTitleMatch) {
                            byIP = parseFloat(byIpTitleMatch[1]);
                        }
                    }

                    // Extract domain from RP: or DOO:
                    let domain = null;
                    const lines = block.split('\n');
                    for (let line of lines) {
                        line = line.trim();
                        
                        // Check RP: first
                        const rpMatch = line.match(/RP:\s*([^\s]+)/);
                        if (rpMatch && rpMatch[1] && !rpMatch[1].includes('[RDNS]')) {
                            domain = rpMatch[1];
                            break;
                        }
                        
                        // If no RP, check DOO:
                        const dooMatch = line.match(/DOO:\s*([^\s]+)/);
                        if (dooMatch && dooMatch[1] && !dooMatch[1].includes('[RDNS]') && !domain) {
                            domain = dooMatch[1];
                        }
                    }
                    
                    if (!byIP || isNaN(byIP)) continue;

                    const blockServers = [];
                    
                    const serverLines = block.match(/^üü¢\s+([a-zA-Z0-9_]+):/gm);
                    if (serverLines) {
                        for (let line of serverLines) {
                            const match = line.match(/üü¢\s+([a-zA-Z0-9_]+):/);
                            if (match && match[1]) blockServers.push(match[1]);
                        }
                    }
                    
                    const downServerLines = block.match(/üí•\s+([^:]+)/g);
                    if (downServerLines) {
                        for (let line of downServerLines) {
                            const match = line.match(/üí•\s+([^:]+)/);
                            if (match && match[1]) {
                                const serverName = match[1].trim().split(':')[0];
                                blockServers.push(serverName);
                            }
                        }
                    }
                    
                    let inServerSection = false;
                    for (let line of lines) {
                        line = line.trim();
                        if (line.match(/^\d+\s+BY\s+IP$/i)) {
                            inServerSection = true;
                            continue;
                        }
                        if (inServerSection && line.match(/^s[\d_]*cmh6[\d_]*/i)) {
                            blockServers.push(line);
                        } else if (inServerSection && line.length > 0 && !line.match(/^s/)) {
                            inServerSection = false;
                        }
                    }

                    if (blockServers.length === 0) {
                        const genericMatches = block.match(/\b(s[\d_]*cmh6[\d_]*)\b/g);
                        if (genericMatches) {
                            genericMatches.forEach(s => {
                                if (!blockServers.includes(s)) blockServers.push(s);
                            });
                        }
                    }

                    blocks.push({
                        id: `block-${blocks.length}-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
                        byIP: byIP,
                        domain: domain,
                        servers: [...new Set(blockServers)],
                        timestamp: timestamp,
                        serverCount: blockServers.length
                    });
                }
                
                return blocks;
            }

            function refreshData() {
                const rawText = rawArea.value;
                allBlocks = parseBlocks(rawText);
                
                blockCountSpan.innerText = allBlocks.length + (allBlocks.length === 1 ? ' block' : ' blocks');

                const ipSet = new Set(allBlocks.map(b => b.byIP));
                uniqueIPs = Array.from(ipSet).sort((a, b) => a - b);
                
                const domainSet = new Set(allBlocks.map(b => b.domain).filter(d => d));
                uniqueDomains = Array.from(domainSet).sort();

                renderPills();

                if (currentFilterType === 'ip' && !ipSet.has(currentFilterValue)) {
                    currentFilterType = null;
                    currentFilterValue = null;
                }
                if (currentFilterType === 'domain' && !domainSet.has(currentFilterValue)) {
                    currentFilterType = null;
                    currentFilterValue = null;
                }

                applyFilter();
            }

            function renderPills() {
                // Render Domain Pills
                if (uniqueDomains.length === 0) {
                    domainPillsContainer.innerHTML = '<span style="color:#4f6b89; padding:6px;">(no domains detected)</span>';
                } else {
                    let domainHtml = '';
                    uniqueDomains.forEach(domain => {
                        const blocksWithDomain = allBlocks.filter(b => b.domain === domain);
                        const totalServers = blocksWithDomain.reduce((acc, b) => acc + b.servers.length, 0);
                        const blockCount = blocksWithDomain.length;
                        const activeClass = (currentFilterType === 'domain' && currentFilterValue === domain) ? 'active' : '';
                        domainHtml += `<div class="ip-pill ${activeClass}" onclick="selectDomain('${domain}')">
                                    ${domain} <span class="server-count">${blockCount} blocks ¬∑ ${totalServers} servers</span>
                                 </div>`;
                    });
                    domainPillsContainer.innerHTML = domainHtml;
                }

                // Render IP Pills
                if (uniqueIPs.length === 0) {
                    ipPillsContainer.innerHTML = '<span style="color:#4f6b89; padding:6px;">(no IP limits detected)</span>';
                } else {
                    let ipHtml = '';
                    uniqueIPs.forEach(ip => {
                        const blocksWithIP = allBlocks.filter(b => b.byIP === ip);
                        const totalServers = blocksWithIP.reduce((acc, b) => acc + b.servers.length, 0);
                        const blockCount = blocksWithIP.length;
                        const activeClass = (currentFilterType === 'ip' && currentFilterValue === ip) ? 'active' : '';
                        ipHtml += `<div class="ip-pill ${activeClass}" onclick="selectIP(${ip})">
                                    ${ip} <span class="server-count">${blockCount} blocks ¬∑ ${totalServers} servers</span>
                                 </div>`;
                    });
                    ipPillsContainer.innerHTML = ipHtml;
                }
            }

            window.selectDomain = function(domain) {
                currentFilterType = 'domain';
                currentFilterValue = domain;
                document.querySelectorAll('#domainPillsContainer .ip-pill').forEach(p => p.classList.remove('active'));
                event.target.closest('.ip-pill').classList.add('active');
                document.querySelectorAll('#ipPillsContainer .ip-pill').forEach(p => p.classList.remove('active'));
                applyFilter();
            };

            window.selectIP = function(ip) {
                currentFilterType = 'ip';
                currentFilterValue = ip;
                document.querySelectorAll('#ipPillsContainer .ip-pill').forEach(p => p.classList.remove('active'));
                event.target.closest('.ip-pill').classList.add('active');
                document.querySelectorAll('#domainPillsContainer .ip-pill').forEach(p => p.classList.remove('active'));
                applyFilter();
            };

            function applyFilter() {
                let filteredBlocks = [];
                let filterLabel = 'üåê all groups';
                
                if (currentFilterType === 'ip') {
                    filteredBlocks = allBlocks.filter(b => b.byIP === currentFilterValue);
                    filterLabel = `üîπ By IP = ${currentFilterValue}`;
                } else if (currentFilterType === 'domain') {
                    filteredBlocks = allBlocks.filter(b => b.domain === currentFilterValue);
                    filterLabel = `üåê By Domain = ${currentFilterValue}`;
                } else {
                    filteredBlocks = allBlocks;
                }

                selectedFilterLabel.innerText = filterLabel;

                const totalServers = filteredBlocks.reduce((acc, b) => acc + b.servers.length, 0);
                serverCountDisplay.innerText = totalServers + (totalServers === 1 ? ' server' : ' servers') + ' across ' + filteredBlocks.length + ' blocks';

                if (filteredBlocks.length === 0) {
                    resultsContainer.innerHTML = `<div class="placeholder-nodata">‚ú® No blocks match</div>`;
                    return;
                }

                let html = '';
                filteredBlocks.forEach((block, idx) => {
                    const ip = block.byIP;
                    const domain = block.domain || 'No domain';
                    const servers = block.servers;
                    const timestamp = block.timestamp;
                    const serverCount = servers.length;
                    const blockId = block.id || `block-${idx}-${Date.now()}`;

                    let serversHtml = '';
                    if (servers.length > 0) {
                        serversHtml = servers.map(s => `<span class="server-chip">${s}</span>`).join('');
                    } else {
                        serversHtml = `<span class="no-servers-chip">‚ö†Ô∏è no server names</span>`;
                    }

                    html += `
                        <div class="block-card">
                            <div class="timestamp-header">
                                <span class="timestamp-badge">‚è±Ô∏è ${timestamp}</span>
                                <span class="server-count-badge">üìä ${serverCount} servers</span>
                            </div>
                            <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 10px; flex-wrap: wrap;">
                                <div class="byip-value" style="font-size: 1.5rem; background: #f59e0b20;">
                                    <i class="fas fa-bullseye"></i> ${ip}
                                </div>
                                ${domain !== 'No domain' ? 
                                    `<div class="byip-value" style="font-size: 1.5rem; background: #10b98120;">
                                        <i class="fas fa-globe"></i> ${domain}
                                    </div>` : 
                                    `<div class="no-domain">No domain</div>`
                                }
                            </div>
                            <div class="servers-in-card">
                                ${serversHtml}
                                ${servers.length > 0 ? `
                                    <button class="copy-btn" onclick='copyServerNames("${blockId}", ${JSON.stringify(servers)})'>
                                        <i class="fas fa-copy"></i> copy all
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    `;
                });

                resultsContainer.innerHTML = html;
            }

            window.copyServerNames = function(blockId, servers) {
                if (!servers || servers.length === 0) {
                    showToast('‚ö†Ô∏è No servers to copy');
                    return;
                }
                
                const textToCopy = servers.join('\n');
                navigator.clipboard.writeText(textToCopy).then(() => {
                    showToast(`‚úÖ Copied ${servers.length} server names`);
                }).catch(err => {
                    showToast('‚ùå Failed to copy');
                });
            };

            function resetDomainFilter() {
                if (currentFilterType === 'domain') {
                    currentFilterType = null;
                    currentFilterValue = null;
                }
                document.querySelectorAll('#domainPillsContainer .ip-pill').forEach(p => p.classList.remove('active'));
                applyFilter();
                showToast('üåê Showing all domains');
            }

            function resetIPFilter() {
                if (currentFilterType === 'ip') {
                    currentFilterType = null;
                    currentFilterValue = null;
                }
                document.querySelectorAll('#ipPillsContainer .ip-pill').forEach(p => p.classList.remove('active'));
                applyFilter();
                showToast('üåê Showing all IPs');
            }

            function fullReset() {
                rawArea.value = '';
                allBlocks = [];
                uniqueIPs = [];
                uniqueDomains = [];
                currentFilterType = null;
                currentFilterValue = null;
                
                blockCountSpan.innerText = '0 blocks';
                selectedFilterLabel.innerText = 'üåê all groups';
                serverCountDisplay.innerText = '0 servers';
                
                renderPills();
                resultsContainer.innerHTML = `<div class="placeholder-nodata">üëÜ paste data, then click any domain or IP pill</div>`;
                
                showToast('‚ú® Reset complete');
            }

            function downloadTable() {
                let blocksToExport = [];
                if (currentFilterType === 'ip') {
                    blocksToExport = allBlocks.filter(b => b.byIP === currentFilterValue);
                } else if (currentFilterType === 'domain') {
                    blocksToExport = allBlocks.filter(b => b.domain === currentFilterValue);
                } else {
                    blocksToExport = allBlocks;
                }

                if (blocksToExport.length === 0) {
                    showToast('No data to export');
                    return;
                }

                const rows = [['timestamp', 'by_ip', 'domain', 'server']];
                blocksToExport.forEach(block => {
                    const ip = block.byIP;
                    const domain = block.domain || '';
                    const timestamp = block.timestamp;
                    if (block.servers.length > 0) {
                        block.servers.forEach(srv => {
                            rows.push([timestamp, ip, domain, srv]);
                        });
                    } else {
                        rows.push([timestamp, ip, domain, '']);
                    }
                });

                let csvContent = rows.map(row => {
                    return row.map(cell => {
                        if (typeof cell === 'string' && (cell.includes(',') || cell.includes('"'))) {
                            return `"${cell.replace(/"/g, '""')}"`;
                        }
                        return cell;
                    }).join(',');
                }).join('\n');

                const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                const filterSuffix = currentFilterType ? `_${currentFilterType}_${currentFilterValue}` : '_all';
                link.setAttribute('download', `domain_ip_blocks${filterSuffix}.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                showToast('üì• CSV downloaded');
            }

            rawArea.addEventListener('input', refreshData);
            resetDomainBtn.addEventListener('click', (e) => {
                e.preventDefault();
                resetDomainFilter();
            });
            resetIPBtn.addEventListener('click', (e) => {
                e.preventDefault();
                resetIPFilter();
            });
            fullResetBtn.addEventListener('click', (e) => {
                e.preventDefault();
                fullReset();
            });
            downloadBtn.addEventListener('click', (e) => {
                e.preventDefault();
                downloadTable();
            });
        })();

        // ==================== TOOL 3: EMAIL ERROR PARSER ====================
        let parsedData = {
            errors: new Map(),
            teams: new Map(),
            ipToErrors: new Map(),
            totalIPs: 0,
            totalErrorTypes: 0,
            totalTeams: 0
        };

        function isIPAddress(str) {
            const ipPattern = /^(\d{1,3}\.){3}\d{1,3}$/;
            return ipPattern.test(str);
        }

        window.parseErrors = function() {
            const input = document.getElementById('inputText').value;
            if (!input.trim()) {
                showToast('Please paste some error log first', 2000, true);
                return;
            }

            showLoading();
            
            parsedData = {
                errors: new Map(),
                teams: new Map(),
                ipToErrors: new Map(),
                totalIPs: 0,
                totalErrorTypes: 0,
                totalTeams: 0
            };

            const lines = input.split('\n');
            let currentTeam = null;
            let currentIPs = [];
            let currentErrorTypes = [];
            let inErrorSection = false;
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                if (!line) continue;
                
                const teamMatch = line.match(/TEAM:\s*(\w+)/);
                if (teamMatch) {
                    currentTeam = teamMatch[1];
                    if (!parsedData.teams.has(currentTeam)) {
                        parsedData.teams.set(currentTeam, new Map());
                    }
                    continue;
                }
                
                if (line.includes('‚ùóÔ∏èErrors ‚ùóÔ∏è:')) {
                    inErrorSection = true;
                    currentIPs = [];
                    currentErrorTypes = [];
                    continue;
                }
                
                if (inErrorSection) {
                    if (isIPAddress(line)) {
                        currentIPs.push(line);
                        continue;
                    }
                    
                    if (line.startsWith('‚ö†Ô∏è')) {
                        const errorType = line.substring(2).trim();
                        currentErrorTypes.push(errorType);
                        
                        if (!parsedData.errors.has(errorType)) {
                            parsedData.errors.set(errorType, {
                                ips: new Set(),
                                teams: new Set(),
                                occurrences: 0
                            });
                        }
                        
                        if (currentTeam) {
                            parsedData.errors.get(errorType).teams.add(currentTeam);
                        }
                        
                        parsedData.errors.get(errorType).occurrences++;
                        
                        currentIPs.forEach(ip => {
                            parsedData.errors.get(errorType).ips.add(ip);
                            
                            if (!parsedData.ipToErrors.has(ip)) {
                                parsedData.ipToErrors.set(ip, new Set());
                            }
                            parsedData.ipToErrors.get(ip).add(errorType);
                            
                            if (currentTeam) {
                                const teamErrors = parsedData.teams.get(currentTeam);
                                if (!teamErrors.has(errorType)) {
                                    teamErrors.set(errorType, new Set());
                                }
                                teamErrors.get(errorType).add(ip);
                            }
                        });
                        
                        continue;
                    }
                    
                    if (line.includes('Total IPs:')) {
                        inErrorSection = false;
                        currentIPs = [];
                        currentErrorTypes = [];
                    }
                }
            }

            parsedData.totalIPs = parsedData.ipToErrors.size;
            parsedData.totalErrorTypes = parsedData.errors.size;
            parsedData.totalTeams = parsedData.teams.size;

            updateSummaryCards();
            updateErrorTabs();
            
            hideLoading();
            showSections();
            
            if (parsedData.totalErrorTypes > 0) {
                showToast(`‚úÖ Found ${parsedData.totalErrorTypes} error types, ${parsedData.totalIPs} IPs`);
            } else {
                showToast('No errors found in the log', 2000, true);
            }
        };

        function updateSummaryCards() {
            const container = document.getElementById('summaryCards');
            container.style.display = 'grid';
            
            let totalOccurrences = 0;
            for (let [_, errorData] of parsedData.errors) {
                totalOccurrences += errorData.occurrences;
            }
            
            container.innerHTML = `
                <div class="summary-card">
                    <div class="label">Error Types</div>
                    <div class="value">${parsedData.totalErrorTypes}</div>
                </div>
                <div class="summary-card">
                    <div class="label">Unique IPs</div>
                    <div class="value">${parsedData.totalIPs}</div>
                </div>
                <div class="summary-card">
                    <div class="label">Teams Affected</div>
                    <div class="value">${parsedData.totalTeams}</div>
                </div>
                <div class="summary-card">
                    <div class="label">Total Errors</div>
                    <div class="value">${totalOccurrences}</div>
                </div>
            `;
        }

        function updateErrorTabs() {
            const tabsContainer = document.getElementById('errorTabs');
            tabsContainer.innerHTML = '';
            
            document.getElementById('errorCount').textContent = `${parsedData.totalErrorTypes} error${parsedData.totalErrorTypes !== 1 ? 's' : ''}`;
            
            if (parsedData.totalErrorTypes === 0) {
                tabsContainer.innerHTML = '<div style="color: #6c757d; padding: 20px; text-align: center;">No errors detected</div>';
                document.getElementById('errorContent').style.display = 'none';
                return;
            }
            
            const sortedErrors = Array.from(parsedData.errors.entries())
                .sort((a, b) => b[1].ips.size - a[1].ips.size);
            
            for (let [errorType, data] of sortedErrors) {
                const tab = document.createElement('div');
                tab.className = 'error-tab';
                tab.setAttribute('data-error', errorType);
                tab.innerHTML = `
                    ${errorType.length > 30 ? errorType.substring(0, 30) + '...' : errorType}
                    <span class="count">${data.ips.size}</span>
                `;
                tab.onclick = () => showErrorDetails(errorType);
                tabsContainer.appendChild(tab);
            }
            
            if (sortedErrors.length > 0) {
                showErrorDetails(sortedErrors[0][0]);
            }
        }

        window.copyErrorIPs = function(errorType) {
            if (!errorType) {
                showToast('Please select an error type first', 2000, true);
                return;
            }

            const errorData = parsedData.errors.get(errorType);
            if (!errorData || errorData.ips.size === 0) {
                showToast('No IPs to copy', 2000, true);
                return;
            }

            const sortedIPs = Array.from(errorData.ips).sort();
            const textToCopy = sortedIPs.join('\n');
            
            navigator.clipboard.writeText(textToCopy).then(() => {
                showToast(`‚úÖ Copied ${sortedIPs.length} IPs to clipboard`);
            }).catch(err => {
                showToast('‚ùå Failed to copy IPs', 2000, true);
            });
        };

        function showErrorDetails(errorType) {
            const errorData = parsedData.errors.get(errorType);
            if (!errorData) return;

            document.querySelectorAll('.error-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.getAttribute('data-error') === errorType) {
                    tab.classList.add('active');
                }
            });

            document.getElementById('errorContent').style.display = 'block';

            let ipListHtml = '';
            const sortedIPs = Array.from(errorData.ips).sort();
            
            for (let ip of sortedIPs) {
                const teamsWithIP = [];
                for (let [team, teamErrors] of parsedData.teams) {
                    if (teamErrors.has(errorType) && teamErrors.get(errorType).has(ip)) {
                        teamsWithIP.push(team);
                    }
                }
                
                const allErrorsForIP = parsedData.ipToErrors.get(ip) || new Set();
                const otherErrors = Array.from(allErrorsForIP)
                    .filter(e => e !== errorType)
                    .join(', ');
                
                ipListHtml += `
                    <div class="ip-item">
                        <span class="ip-address">${ip}</span>
                        <div class="ip-teams">
                            ${teamsWithIP.map(team => `<span class="team-badge">Team ${team}</span>`).join('')}
                            ${otherErrors ? `<span class="team-badge" style="background: #e9ecef; color: #495057;" title="Also has: ${otherErrors}">also has other errors</span>` : ''}
                        </div>
                    </div>
                `;
            }

            const content = document.getElementById('errorContent');
            content.innerHTML = `
                <div class="error-stats">
                    <div class="error-stats-grid">
                        <div class="error-stat-item">
                            <div class="error-stat-label">Error Type</div>
                            <div class="error-stat-value">${errorType}</div>
                        </div>
                        <div class="error-stat-item">
                            <div class="error-stat-label">Total IPs</div>
                            <div class="error-stat-value">${errorData.ips.size}</div>
                        </div>
                        <div class="error-stat-item">
                            <div class="error-stat-label">Occurrences</div>
                            <div class="error-stat-value">${errorData.occurrences}</div>
                        </div>
                        <div class="error-stat-item">
                            <div class="error-stat-label">Teams</div>
                            <div class="error-stat-value">${errorData.teams.size}</div>
                        </div>
                    </div>
                </div>
                <div class="ip-list">
                    <div class="ip-list-header">
                        <span>IP Addresses (${errorData.ips.size} total)</span>
                        <button class="copy-ips-btn" onclick="copyErrorIPs('${errorType.replace(/'/g, "\\'")}')">
                            <i class="fas fa-copy"></i> Copy All IPs
                        </button>
                    </div>
                    ${ipListHtml || '<div class="no-data">No IPs found for this error type</div>'}
                </div>
            `;
        }

        window.resetEmailParser = function() {
            document.getElementById('inputText').value = '';
            
            parsedData = {
                errors: new Map(),
                teams: new Map(),
                ipToErrors: new Map(),
                totalIPs: 0,
                totalErrorTypes: 0,
                totalTeams: 0
            };

            document.getElementById('summaryCards').style.display = 'none';
            document.getElementById('errorSelector').style.display = 'none';
            document.getElementById('errorTabs').innerHTML = '';
            document.getElementById('errorContent').style.display = 'none';
            document.getElementById('errorCount').textContent = '0 errors';
            
            showToast('Email Parser - cleared');
        };

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        function showSections() {
            document.getElementById('summaryCards').style.display = 'grid';
            document.getElementById('errorSelector').style.display = 'block';
        }
    </script>
</body>
</html>
